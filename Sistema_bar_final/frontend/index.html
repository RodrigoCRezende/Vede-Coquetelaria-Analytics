<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>VedÃª â€“ Coquetelaria & Arte</title>
    <style>
        body { font-family: sans-serif; background: #fdfbf7; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; color: #333; }
        .box { background: white; padding: 40px; border-radius: 10px; width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 5px solid #0f3d0f; }
        input { width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; }
        button { width: 100%; padding: 10px; margin-top: 10px; border: none; cursor: pointer; font-weight: bold; }
        .btn-verde { background: #0f3d0f; color: #c0a062; }
        .btn-gold { background: #c0a062; color: white; }
        .hidden { display: none; }
        .card { background: #fff; padding: 15px; margin: 10px; border: 1px solid #ddd; border-radius: 5px; text-align: center; }
        .tag-alta { background: #ffc107; padding: 2px 5px; font-size: 11px; border-radius: 3px; }
    </style>
</head>
<body>

    <div id="login" class="box">
        <h1 style="color:#0f3d0f; margin:0;">VedÃª</h1>
        <small style="color:#c0a062; letter-spacing:2px;">COQUETELARIA & ARTE</small>
        <br><br>
        <input type="text" id="user" placeholder="admin">
        <input type="password" id="pass" placeholder="123">
        <button class="btn-verde" onclick="fazerLogin()">ACESSAR</button>
    </div>

    <div id="dash" class="box hidden" style="width: 800px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="color:#0f3d0f; margin:0;">Painel Gerencial</h2>
            <button onclick="location.reload()" style="width:auto; background:#dc3545; color:white;">Sair</button>
        </div>

        <div style="background:#f9f9f9; padding:20px; border-radius:10px; margin-top:20px; border:1px solid #eee;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>ðŸ”® PrevisÃ£o IA (Python)</h3>
                <button class="btn-gold" style="width:auto;" onclick="chamarIA()">Calcular Fim de Semana</button>
            </div>
            <div id="res-ia" style="display:flex; gap:10px; margin-top:10px; min-height:50px; justify-content:center; color:gray;">
                Clique no botÃ£o para consultar a API Python...
            </div>
        </div>

        <div style="display:flex; gap:20px; margin-top:20px;">
            <div class="card" style="flex:1">
                <h3>Vendas Hoje</h3>
                <h1 style="color:green; margin:10px;">R$ 1.250,00</h1>
            </div>
            <div class="card" style="flex:1; background:#fafafa;">
                <h3>Simulador PDV</h3>
                <button style="background:white; border:1px solid green; color:green;" onclick="vender('Gin')">Vender Gin</button>
                <button style="background:white; border:1px solid green; color:green;" onclick="vender('Heineken')">Vender Cerveja</button>
                <p id="msg" style="color:green; font-weight:bold; font-size:12px;"></p>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURAÃ‡ÃƒO ATUALIZADA (Porta 5002 na IA) ---
        const API_NODE = 'http://127.0.0.1:5000';
        const API_PYTHON = 'http://127.0.0.1:5002'; // <--- MUDANÃ‡A AQUI

        async function fazerLogin() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            try {
                const res = await fetch(`${API_NODE}/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({usuario: u, senha: p})
                });
                const dados = await res.json();
                if(dados.auth) {
                    document.getElementById('login').classList.add('hidden');
                    document.getElementById('dash').classList.remove('hidden');
                } else { alert("Senha incorreta!"); }
            } catch(e) { alert("ERRO: Ligue o Servidor Python na porta 5000!"); }
        }

        async function chamarIA() {
            document.getElementById('res-ia').innerText = "Carregando...";
            try {
                // Vai chamar a porta 5002 agora
                const res = await fetch(`${API_PYTHON}/previsao`);
                const dados = await res.json();
                let html = "";
                dados.forEach(d => {
                    html += `
                        <div class="card" style="flex:1; margin:0;">
                            <h4>${d.dia}</h4>
                            <div style="color:#0f3d0f; font-weight:bold; font-size:18px;">${d.valor}</div>
                            <span class="tag-alta">${d.status}</span>
                        </div>`;
                });
                document.getElementById('res-ia').innerHTML = html;
            } catch(e) { 
                console.log(e);
                alert("ERRO: Verifique se a IA estÃ¡ rodando na porta 5002!"); 
            }
        }

        async function vender(item) {
            try {
                await fetch(`${API_NODE}/vendas`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({produto: item, valor: 30})
                });
                document.getElementById('msg').innerText = "âœ… Registrado no Python (Backend)!";
                setTimeout(()=>document.getElementById('msg').innerText="", 2000);
            } catch(e) { alert("Erro no Backend"); }
        }
    </script>
</body>
</html>